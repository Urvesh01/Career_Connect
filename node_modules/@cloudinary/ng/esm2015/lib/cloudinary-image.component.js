import { Component, Input, ElementRef } from '@angular/core';
import { CloudinaryImage } from '@cloudinary/url-gen/assets/CloudinaryImage';
import { cancelCurrentlyRunningPlugins, HtmlImageLayer } from '@cloudinary/html';
import { SDKAnalyticsConstants } from '../internal/SDKAnalyticsConstants';
import * as i0 from "@angular/core";
/**
 * @mixin AngularSDK
 * @description The Cloudinary Angular SDK contains components like \<advanced-image\> to easily render your media assets from
 * Cloudinary. The SDK also comes with support for optional JS plugins that make the components smart, with features
 * like lazy loading, placeholder, accessibility & responsiveness.
 *
 * @example
 * <caption>
 *  Please note that the order of the plugins is important. See {@link https://cloudinary.com/documentation/sdks/js/frontend-frameworks/index.html#plugin-order|Plugin Order} for more details.
 * </caption>
 * // In your app.module.ts inject the library.
 * import { CloudinaryModule} from '@cloudinary/angular';
 *
 * imports: [
 *   ...,
 *   CloudinaryModule,
 * ],
 *
 * // In your component.ts use `@cloudinary/url-gen` to generate your transformations.
 * // Import the plugins you wish to use
 *
 * import {CloudinaryImage} from "@cloudinary/url-gen/assets/CloudinaryImage";
 * import {
 *  AdvancedImage,
 *  accessibility,
 *  responsive,
 *  lazyload,
 *  placeholder
 * } from '@cloudinary/angular';
 *
 * ngOnInit() {
 *   const myCld = new Cloudinary({ cloudName: 'demo'});
 *   this.img = myCld().image('sample');
 *
 *   this.plugins = [lazyload(), placeholder()]
 * }
 *
 * // In your view add the component with your transformation.
 * <advanced-image [cldImg]="this.img" [plugins]="this.plugins"></advanced-image>
 */
/**
 * @memberOf AngularSDK
 * @type {Component}
 * @description The Cloudinary image component.
 * @prop {CloudinaryImage} transformation Generated by @cloudinary/url-gen
 * @prop {Plugins} plugins Advanced image component plugins accessibility(), responsive(), lazyload(), placeholder()
 * @prop imageAttributes Optional attributes include alt, width, height, loading
 */
export class CloudinaryImageComponent {
    constructor(el) {
        this.el = el;
    }
    /**
     * On init creates a new HTMLLayer instance and initializes with ref to img element,
     * user generated cloudinaryImage and the plugins to be used.
     */
    ngOnInit() {
        this.htmlLayerInstance = new HtmlImageLayer(this.el.nativeElement.children[0], this.cldImg, this.plugins, SDKAnalyticsConstants);
        this.syncAttributes();
    }
    /**
     * On update, we cancel running plugins and update the image instance with the state of user
     * cloudinaryImage and the state of plugins.
     */
    ngOnChanges() {
        if (this.htmlLayerInstance) {
            cancelCurrentlyRunningPlugins(this.htmlLayerInstance.htmlPluginState);
            this.htmlLayerInstance.update(this.cldImg, this.plugins, SDKAnalyticsConstants);
            this.syncAttributes();
        }
    }
    /**
     * On destroy, we cancel the currently running plugins.
     */
    ngOnDestroy() {
        // safely cancel running events on destroy
        cancelCurrentlyRunningPlugins(this.htmlLayerInstance.htmlPluginState);
    }
    /**
     * Sync attributes to img element.
     */
    syncAttributes() {
        ['alt', 'width', 'height', 'loading'].forEach(attr => {
            const isAttributeSet = this[attr] !== undefined && this[attr] !== null;
            if (isAttributeSet) {
                this.el.nativeElement.children[0].setAttribute(attr, this[attr]);
                this.el.nativeElement.removeAttribute(attr);
            }
            else {
                this.el.nativeElement.children[0].removeAttribute(attr);
            }
        });
    }
}
CloudinaryImageComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.17", ngImport: i0, type: CloudinaryImageComponent, deps: [{ token: i0.ElementRef }], target: i0.ɵɵFactoryTarget.Component });
CloudinaryImageComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "12.2.17", type: CloudinaryImageComponent, selector: "advanced-image", inputs: { cldImg: "cldImg", plugins: "plugins", alt: "alt", width: "width", height: "height", loading: "loading" }, usesOnChanges: true, ngImport: i0, template: `
    <img />
  `, isInline: true, styles: [":host{display:block}\n"] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.17", ngImport: i0, type: CloudinaryImageComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'advanced-image',
                    template: `
    <img />
  `,
                    styleUrls: ['./cloudinary-image.component.css']
                }]
        }], ctorParameters: function () { return [{ type: i0.ElementRef }]; }, propDecorators: { cldImg: [{
                type: Input,
                args: ['cldImg']
            }], plugins: [{
                type: Input,
                args: ['plugins']
            }], alt: [{
                type: Input,
                args: ['alt']
            }], width: [{
                type: Input,
                args: ['width']
            }], height: [{
                type: Input,
                args: ['height']
            }], loading: [{
                type: Input,
                args: ['loading']
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2xvdWRpbmFyeS1pbWFnZS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvbGliL2Nsb3VkaW5hcnktaW1hZ2UuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBQyxTQUFTLEVBQVUsS0FBSyxFQUFFLFVBQVUsRUFBdUIsTUFBTSxlQUFlLENBQUM7QUFDekYsT0FBTyxFQUFDLGVBQWUsRUFBQyxNQUFNLDRDQUE0QyxDQUFDO0FBQzNFLE9BQU8sRUFDTCw2QkFBNkIsRUFDN0IsY0FBYyxFQUVmLE1BQU0sa0JBQWtCLENBQUM7QUFDMUIsT0FBTyxFQUFDLHFCQUFxQixFQUFDLE1BQU0sbUNBQW1DLENBQUM7O0FBRXhFOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7R0F1Q0c7QUFFSDs7Ozs7OztHQU9HO0FBUUgsTUFBTSxPQUFPLHdCQUF3QjtJQVFuQyxZQUFvQixFQUFjO1FBQWQsT0FBRSxHQUFGLEVBQUUsQ0FBWTtJQUFJLENBQUM7SUFFdkM7OztPQUdHO0lBQ0gsUUFBUTtRQUNOLElBQUksQ0FBQyxpQkFBaUIsR0FBRyxJQUFJLGNBQWMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsT0FBTyxFQUFFLHFCQUFxQixDQUFDLENBQUM7UUFDakksSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO0lBQ3hCLENBQUM7SUFFRDs7O09BR0c7SUFDSCxXQUFXO1FBQ1QsSUFBSSxJQUFJLENBQUMsaUJBQWlCLEVBQUU7WUFDMUIsNkJBQTZCLENBQUMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLGVBQWUsQ0FBQyxDQUFDO1lBQ3RFLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsT0FBTyxFQUFFLHFCQUFxQixDQUFDLENBQUM7WUFDaEYsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO1NBQ3ZCO0lBQ0gsQ0FBQztJQUVEOztPQUVHO0lBQ0gsV0FBVztRQUNULDBDQUEwQztRQUMxQyw2QkFBNkIsQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsZUFBZSxDQUFDLENBQUM7SUFDeEUsQ0FBQztJQUVEOztPQUVHO0lBQ0gsY0FBYztRQUNaLENBQUMsS0FBSyxFQUFFLE9BQU8sRUFBRSxRQUFRLEVBQUUsU0FBUyxDQUFDLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFO1lBQ25ELE1BQU0sY0FBYyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxTQUFTLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLElBQUksQ0FBQztZQUN2RSxJQUFJLGNBQWMsRUFBRTtnQkFDbEIsSUFBSSxDQUFDLEVBQUUsQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLFlBQVksQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7Z0JBQ2pFLElBQUksQ0FBQyxFQUFFLENBQUMsYUFBYSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsQ0FBQzthQUM3QztpQkFBTTtnQkFDTCxJQUFJLENBQUMsRUFBRSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxDQUFDO2FBQ3pEO1FBQ0gsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDOztzSEFwRFUsd0JBQXdCOzBHQUF4Qix3QkFBd0IsK0xBTHpCOztHQUVUOzRGQUdVLHdCQUF3QjtrQkFQcEMsU0FBUzttQkFBQztvQkFDVCxRQUFRLEVBQUUsZ0JBQWdCO29CQUMxQixRQUFRLEVBQUU7O0dBRVQ7b0JBQ0QsU0FBUyxFQUFFLENBQUMsa0NBQWtDLENBQUM7aUJBQ2hEO2lHQUVrQixNQUFNO3NCQUF0QixLQUFLO3VCQUFDLFFBQVE7Z0JBQ0csT0FBTztzQkFBeEIsS0FBSzt1QkFBQyxTQUFTO2dCQUNGLEdBQUc7c0JBQWhCLEtBQUs7dUJBQUMsS0FBSztnQkFDSSxLQUFLO3NCQUFwQixLQUFLO3VCQUFDLE9BQU87Z0JBQ0csTUFBTTtzQkFBdEIsS0FBSzt1QkFBQyxRQUFRO2dCQUNHLE9BQU87c0JBQXhCLEtBQUs7dUJBQUMsU0FBUyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7Q29tcG9uZW50LCBPbkluaXQsIElucHV0LCBFbGVtZW50UmVmLCBPbkRlc3Ryb3ksIE9uQ2hhbmdlc30gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge0Nsb3VkaW5hcnlJbWFnZX0gZnJvbSAnQGNsb3VkaW5hcnkvdXJsLWdlbi9hc3NldHMvQ2xvdWRpbmFyeUltYWdlJztcbmltcG9ydCB7XG4gIGNhbmNlbEN1cnJlbnRseVJ1bm5pbmdQbHVnaW5zLFxuICBIdG1sSW1hZ2VMYXllcixcbiAgUGx1Z2luc1xufSBmcm9tICdAY2xvdWRpbmFyeS9odG1sJztcbmltcG9ydCB7U0RLQW5hbHl0aWNzQ29uc3RhbnRzfSBmcm9tICcuLi9pbnRlcm5hbC9TREtBbmFseXRpY3NDb25zdGFudHMnO1xuXG4vKipcbiAqIEBtaXhpbiBBbmd1bGFyU0RLXG4gKiBAZGVzY3JpcHRpb24gVGhlIENsb3VkaW5hcnkgQW5ndWxhciBTREsgY29udGFpbnMgY29tcG9uZW50cyBsaWtlIFxcPGFkdmFuY2VkLWltYWdlXFw+IHRvIGVhc2lseSByZW5kZXIgeW91ciBtZWRpYSBhc3NldHMgZnJvbVxuICogQ2xvdWRpbmFyeS4gVGhlIFNESyBhbHNvIGNvbWVzIHdpdGggc3VwcG9ydCBmb3Igb3B0aW9uYWwgSlMgcGx1Z2lucyB0aGF0IG1ha2UgdGhlIGNvbXBvbmVudHMgc21hcnQsIHdpdGggZmVhdHVyZXNcbiAqIGxpa2UgbGF6eSBsb2FkaW5nLCBwbGFjZWhvbGRlciwgYWNjZXNzaWJpbGl0eSAmIHJlc3BvbnNpdmVuZXNzLlxuICpcbiAqIEBleGFtcGxlXG4gKiA8Y2FwdGlvbj5cbiAqICBQbGVhc2Ugbm90ZSB0aGF0IHRoZSBvcmRlciBvZiB0aGUgcGx1Z2lucyBpcyBpbXBvcnRhbnQuIFNlZSB7QGxpbmsgaHR0cHM6Ly9jbG91ZGluYXJ5LmNvbS9kb2N1bWVudGF0aW9uL3Nka3MvanMvZnJvbnRlbmQtZnJhbWV3b3Jrcy9pbmRleC5odG1sI3BsdWdpbi1vcmRlcnxQbHVnaW4gT3JkZXJ9IGZvciBtb3JlIGRldGFpbHMuXG4gKiA8L2NhcHRpb24+XG4gKiAvLyBJbiB5b3VyIGFwcC5tb2R1bGUudHMgaW5qZWN0IHRoZSBsaWJyYXJ5LlxuICogaW1wb3J0IHsgQ2xvdWRpbmFyeU1vZHVsZX0gZnJvbSAnQGNsb3VkaW5hcnkvYW5ndWxhcic7XG4gKlxuICogaW1wb3J0czogW1xuICogICAuLi4sXG4gKiAgIENsb3VkaW5hcnlNb2R1bGUsXG4gKiBdLFxuICpcbiAqIC8vIEluIHlvdXIgY29tcG9uZW50LnRzIHVzZSBgQGNsb3VkaW5hcnkvdXJsLWdlbmAgdG8gZ2VuZXJhdGUgeW91ciB0cmFuc2Zvcm1hdGlvbnMuXG4gKiAvLyBJbXBvcnQgdGhlIHBsdWdpbnMgeW91IHdpc2ggdG8gdXNlXG4gKlxuICogaW1wb3J0IHtDbG91ZGluYXJ5SW1hZ2V9IGZyb20gXCJAY2xvdWRpbmFyeS91cmwtZ2VuL2Fzc2V0cy9DbG91ZGluYXJ5SW1hZ2VcIjtcbiAqIGltcG9ydCB7XG4gKiAgQWR2YW5jZWRJbWFnZSxcbiAqICBhY2Nlc3NpYmlsaXR5LFxuICogIHJlc3BvbnNpdmUsXG4gKiAgbGF6eWxvYWQsXG4gKiAgcGxhY2Vob2xkZXJcbiAqIH0gZnJvbSAnQGNsb3VkaW5hcnkvYW5ndWxhcic7XG4gKlxuICogbmdPbkluaXQoKSB7XG4gKiAgIGNvbnN0IG15Q2xkID0gbmV3IENsb3VkaW5hcnkoeyBjbG91ZE5hbWU6ICdkZW1vJ30pO1xuICogICB0aGlzLmltZyA9IG15Q2xkKCkuaW1hZ2UoJ3NhbXBsZScpO1xuICpcbiAqICAgdGhpcy5wbHVnaW5zID0gW2xhenlsb2FkKCksIHBsYWNlaG9sZGVyKCldXG4gKiB9XG4gKlxuICogLy8gSW4geW91ciB2aWV3IGFkZCB0aGUgY29tcG9uZW50IHdpdGggeW91ciB0cmFuc2Zvcm1hdGlvbi5cbiAqIDxhZHZhbmNlZC1pbWFnZSBbY2xkSW1nXT1cInRoaXMuaW1nXCIgW3BsdWdpbnNdPVwidGhpcy5wbHVnaW5zXCI+PC9hZHZhbmNlZC1pbWFnZT5cbiAqL1xuXG4vKipcbiAqIEBtZW1iZXJPZiBBbmd1bGFyU0RLXG4gKiBAdHlwZSB7Q29tcG9uZW50fVxuICogQGRlc2NyaXB0aW9uIFRoZSBDbG91ZGluYXJ5IGltYWdlIGNvbXBvbmVudC5cbiAqIEBwcm9wIHtDbG91ZGluYXJ5SW1hZ2V9IHRyYW5zZm9ybWF0aW9uIEdlbmVyYXRlZCBieSBAY2xvdWRpbmFyeS91cmwtZ2VuXG4gKiBAcHJvcCB7UGx1Z2luc30gcGx1Z2lucyBBZHZhbmNlZCBpbWFnZSBjb21wb25lbnQgcGx1Z2lucyBhY2Nlc3NpYmlsaXR5KCksIHJlc3BvbnNpdmUoKSwgbGF6eWxvYWQoKSwgcGxhY2Vob2xkZXIoKVxuICogQHByb3AgaW1hZ2VBdHRyaWJ1dGVzIE9wdGlvbmFsIGF0dHJpYnV0ZXMgaW5jbHVkZSBhbHQsIHdpZHRoLCBoZWlnaHQsIGxvYWRpbmdcbiAqL1xuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnYWR2YW5jZWQtaW1hZ2UnLFxuICB0ZW1wbGF0ZTogYFxuICAgIDxpbWcgLz5cbiAgYCxcbiAgc3R5bGVVcmxzOiBbJy4vY2xvdWRpbmFyeS1pbWFnZS5jb21wb25lbnQuY3NzJ11cbn0pXG5leHBvcnQgY2xhc3MgQ2xvdWRpbmFyeUltYWdlQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkNoYW5nZXMsIE9uRGVzdHJveSB7XG4gIEBJbnB1dCgnY2xkSW1nJykgY2xkSW1nOiBDbG91ZGluYXJ5SW1hZ2U7XG4gIEBJbnB1dCgncGx1Z2lucycpIHBsdWdpbnM6IFBsdWdpbnM7XG4gIEBJbnB1dCgnYWx0JykgYWx0OiBzdHJpbmc7XG4gIEBJbnB1dCgnd2lkdGgnKSB3aWR0aDogc3RyaW5nO1xuICBASW5wdXQoJ2hlaWdodCcpIGhlaWdodDogc3RyaW5nO1xuICBASW5wdXQoJ2xvYWRpbmcnKSBsb2FkaW5nOiBzdHJpbmc7XG4gIGh0bWxMYXllckluc3RhbmNlOiBIdG1sSW1hZ2VMYXllcjtcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBlbDogRWxlbWVudFJlZikgeyB9XG5cbiAgLyoqXG4gICAqIE9uIGluaXQgY3JlYXRlcyBhIG5ldyBIVE1MTGF5ZXIgaW5zdGFuY2UgYW5kIGluaXRpYWxpemVzIHdpdGggcmVmIHRvIGltZyBlbGVtZW50LFxuICAgKiB1c2VyIGdlbmVyYXRlZCBjbG91ZGluYXJ5SW1hZ2UgYW5kIHRoZSBwbHVnaW5zIHRvIGJlIHVzZWQuXG4gICAqL1xuICBuZ09uSW5pdCgpIHtcbiAgICB0aGlzLmh0bWxMYXllckluc3RhbmNlID0gbmV3IEh0bWxJbWFnZUxheWVyKHRoaXMuZWwubmF0aXZlRWxlbWVudC5jaGlsZHJlblswXSwgdGhpcy5jbGRJbWcsIHRoaXMucGx1Z2lucywgU0RLQW5hbHl0aWNzQ29uc3RhbnRzKTtcbiAgICB0aGlzLnN5bmNBdHRyaWJ1dGVzKCk7XG4gIH1cblxuICAvKipcbiAgICogT24gdXBkYXRlLCB3ZSBjYW5jZWwgcnVubmluZyBwbHVnaW5zIGFuZCB1cGRhdGUgdGhlIGltYWdlIGluc3RhbmNlIHdpdGggdGhlIHN0YXRlIG9mIHVzZXJcbiAgICogY2xvdWRpbmFyeUltYWdlIGFuZCB0aGUgc3RhdGUgb2YgcGx1Z2lucy5cbiAgICovXG4gIG5nT25DaGFuZ2VzKCkge1xuICAgIGlmICh0aGlzLmh0bWxMYXllckluc3RhbmNlKSB7XG4gICAgICBjYW5jZWxDdXJyZW50bHlSdW5uaW5nUGx1Z2lucyh0aGlzLmh0bWxMYXllckluc3RhbmNlLmh0bWxQbHVnaW5TdGF0ZSk7XG4gICAgICB0aGlzLmh0bWxMYXllckluc3RhbmNlLnVwZGF0ZSh0aGlzLmNsZEltZywgdGhpcy5wbHVnaW5zLCBTREtBbmFseXRpY3NDb25zdGFudHMpO1xuICAgICAgdGhpcy5zeW5jQXR0cmlidXRlcygpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBPbiBkZXN0cm95LCB3ZSBjYW5jZWwgdGhlIGN1cnJlbnRseSBydW5uaW5nIHBsdWdpbnMuXG4gICAqL1xuICBuZ09uRGVzdHJveSgpIHtcbiAgICAvLyBzYWZlbHkgY2FuY2VsIHJ1bm5pbmcgZXZlbnRzIG9uIGRlc3Ryb3lcbiAgICBjYW5jZWxDdXJyZW50bHlSdW5uaW5nUGx1Z2lucyh0aGlzLmh0bWxMYXllckluc3RhbmNlLmh0bWxQbHVnaW5TdGF0ZSk7XG4gIH1cblxuICAvKipcbiAgICogU3luYyBhdHRyaWJ1dGVzIHRvIGltZyBlbGVtZW50LlxuICAgKi9cbiAgc3luY0F0dHJpYnV0ZXMoKSB7XG4gICAgWydhbHQnLCAnd2lkdGgnLCAnaGVpZ2h0JywgJ2xvYWRpbmcnXS5mb3JFYWNoKGF0dHIgPT4ge1xuICAgICAgY29uc3QgaXNBdHRyaWJ1dGVTZXQgPSB0aGlzW2F0dHJdICE9PSB1bmRlZmluZWQgJiYgdGhpc1thdHRyXSAhPT0gbnVsbDtcbiAgICAgIGlmIChpc0F0dHJpYnV0ZVNldCkge1xuICAgICAgICB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQuY2hpbGRyZW5bMF0uc2V0QXR0cmlidXRlKGF0dHIsIHRoaXNbYXR0cl0pO1xuICAgICAgICB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQucmVtb3ZlQXR0cmlidXRlKGF0dHIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5lbC5uYXRpdmVFbGVtZW50LmNoaWxkcmVuWzBdLnJlbW92ZUF0dHJpYnV0ZShhdHRyKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxufVxuIl19